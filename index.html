<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Whisper Voice Input Demo</title>
</head>
<body>
  <h2>üéôÔ∏è Whisper Voice Input Demo</h2>

  <button id="recordBtn">Start Recording</button>
  <input type="text" id="transcript" placeholder="Your transcription will appear here" style="width: 400px; margin-left: 10px;">

  <script>
    const recordBtn = document.getElementById("recordBtn");
    const transcriptField = document.getElementById("transcript");

    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;

    recordBtn.onclick = async () => {
      if (!isRecording) {
        // Start recording
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        audioChunks = [];
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

        mediaRecorder.onstop = async () => {
          // Combine audio chunks into a Blob
          const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
          audioChunks = [];

          // Send to Flask backend
          const formData = new FormData();
          formData.append("file", audioBlob, "recording.webm");

          try {
            const response = await fetch("http://localhost:5000/transcribe", {
              method: "POST",
              body: formData
            });

            const data = await response.json();
            transcriptField.value = data.text || "No transcription found.";
          } catch (err) {
            console.error(err);
            transcriptField.value = "Error transcribing audio.";
          }
        };

        mediaRecorder.start();
        isRecording = true;
        recordBtn.textContent = "Stop Recording";
      } else {
        // Stop recording
        mediaRecorder.stop();
        isRecording = false;
        recordBtn.textContent = "Start Recording";
      }
    };
  </script>
</body>
</html>
